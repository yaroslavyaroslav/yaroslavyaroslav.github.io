<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>My dear diary</title><link>https://yaroslavyaroslav.github.io/</link><description>My dear diary</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 22 Aug 2022 17:01:43 +0700</lastBuildDate><atom:link href="https://yaroslavyaroslav.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>My First Post</title><link>https://yaroslavyaroslav.github.io/posts/my-first-post/</link><pubDate>Mon, 22 Aug 2022 17:01:43 +0700</pubDate><guid>https://yaroslavyaroslav.github.io/posts/my-first-post/</guid><description>&lt;h1 id="dynamic-generic-types" >Dynamic generic types
&lt;span>
&lt;a href="#dynamic-generic-types">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h1>&lt;h2 id="abstract" >Abstract
&lt;span>
&lt;a href="#abstract">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h2>&lt;p>Prior the &lt;strong>Swift 5.7&lt;/strong> release there is a lack of using protocol with &lt;code>associatedtype&lt;/code> as a type of arguments of a method rather as a returning type. As well as this release gives a really convenient way to solve that task with &lt;a href="https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md" title="">SE-0309&lt;/a> and &lt;a href="https://github.com/apple/swift-evolution/blob/main/proposals/0346-light-weight-same-type-syntax.md" title="">SE-0346&lt;/a>, this options still not available for any previous iOS rather then iOS/iPadOS 16 and macOS 13 and for Swift language any previous version itself.&lt;/p>
&lt;blockquote>
&lt;p>As Apple states itself at appropriate WWDC 2022 video: the only way to get same abilities in previous swift versions — do a lot of boilerplate code e.g. to write as much overloaded methods as it needs to cover all cases.&lt;/p>
&lt;/blockquote>
&lt;p>The way to solve this kind of tasks in prior swift versions is the target of this paper.&lt;/p>
&lt;h2 id="problem-overview" >Problem overview
&lt;span>
&lt;a href="#problem-overview">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h2>&lt;p>The problem comes from the protocols restrictions on one hand and generics restrictions on another. Let’s dig it a bit.&lt;/p>
&lt;p>So let’s say we’re willing to implement method that will be decode any &lt;code>Decodable&lt;/code> object that i’ll get. This is actually a meaningful task in case that we’re receiving some useful server response wrapped within almost static object, and we want to cover this response with a single type.&lt;/p>
&lt;p>Here’s the example of possible received JSON objects:
First object&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-JSON" data-lang="JSON">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;id&amp;#34;&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;result&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;firstKey&amp;#34;&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;secondKey&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;second&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;client&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;iOS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Second object:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;id&amp;#34;&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;result&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;thidrKey&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;okok&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;fourthKey&amp;#34;&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;fifthKey&amp;#34;&lt;/span>: &lt;span style="color:#ae81ff">1231&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;client&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;iOS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Leaving API design quality out of scope, let’s work with what we’ve got.&lt;/p>
&lt;p>So in this case preferred solution would be to implement one generic method and three structures, one for each given result case and one for response itself.&lt;/p>
&lt;p>So let’s do it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-swift" data-lang="swift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// `result` object for first kind of server response&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ResultFirstKind&lt;/span>: Decodable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> firstKey: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> secondKey: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// `result` object for second kind of server response&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ResultSecondKind&lt;/span>: Decodable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> thidrKey: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> fourthKey: Bool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> fifthKey: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Everything is going good so far, let’s implement the wrapper type head-on:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-swift" data-lang="swift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Response&lt;/span>: Decodable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> id: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> result: Decodable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> client: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">send&lt;/span>(uRLRequest: URLRequest, with session: URLSession) async &lt;span style="color:#66d9ef">throws&lt;/span> -&amp;gt; Response {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (data, response) = &lt;span style="color:#66d9ef">try&lt;/span> await session.data(&lt;span style="color:#66d9ef">for&lt;/span>: uRLRequest)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">guard&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> == response.statusCode &lt;span style="color:#66d9ef">else&lt;/span> { fatalError() }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">try&lt;/span> JSONDecoder().decode(APIResponse.&lt;span style="color:#66d9ef">self&lt;/span>, from: data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And here’s we’ve faced huge problem:&lt;/p>
&lt;blockquote>
&lt;p>Compiler could not infers type of concrete &lt;code>result&lt;/code> field in such implementation for exact call. Since it could be &lt;strong>any&lt;/strong> decodable type e.g. and there’s not even a hint to which it will be in exact call. So it can’t infers what will be passed to next calls where this &lt;code>Response&lt;/code> object will be passed&lt;/p>
&lt;/blockquote>
&lt;p>There’s also another issue raises here: &lt;code>Decodable&lt;/code> protocol is too broad. Like every &lt;code>String&lt;/code> numeric and maybe some of other types in your code are conforms it, but you’re waiting exact given types to be recieved within server response.&lt;/p>
&lt;p>But hopefully the latter one solves easily: &lt;code>Response&lt;/code> type evolves to follow:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-swift" data-lang="swift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protocol&lt;/span> &lt;span style="color:#a6e22e">Result&lt;/span>: Decodable { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">extension&lt;/span> &lt;span style="color:#a6e22e">ResultFirstKind&lt;/span>: Result { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">extension&lt;/span> &lt;span style="color:#a6e22e">ResultSecondKind&lt;/span>: Result { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Response&lt;/span>: Decodable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> id: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> result: Result
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> client: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This evolving solves only one of issues — it restricts possible types to be assigned to &lt;code>result&lt;/code> property to only one that conforms &lt;code>Result&lt;/code> protocol, but still this code is not compiling and still swift can’t infer type that should be used on method run.&lt;/p>
&lt;p>The other way which is seems workable here is to add an&lt;code>associatedtype&lt;/code> value into a protocol, which is looked like made exactly for this kind of tasks, this solution could look like follow:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-swift" data-lang="swift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protocol&lt;/span> &lt;span style="color:#a6e22e">Responsable&lt;/span>: Decodable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/// ``Result`` are conforms ``Decodable``&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> associatedtype Result: Result
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> id: Int { &lt;span style="color:#66d9ef">get&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> result: Result { &lt;span style="color:#66d9ef">get&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> client: String { &lt;span style="color:#66d9ef">get&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Response&lt;/span>: Responsable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> id: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> result: Result
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> client: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So here we’re saying that &lt;code>Result&lt;/code> type that is the type of &lt;code>result&lt;/code> property if of &lt;code>Response&lt;/code> object is one that conforms with &lt;code>Result&lt;/code> protocol.&lt;/p>
&lt;p>This method is actually is the most straightforward and preferable and &lt;strong>yet not compiles prior swift 5.7&lt;/strong>. This comes that protocols with &lt;code>associatedtype&lt;/code> in it could not be used as a constraints in generic methods in any past swift version.&lt;/p>
&lt;h2 id="problem-summary" >Problem summary
&lt;span>
&lt;a href="#problem-summary">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h2>&lt;p>So let’s provide problem summary:&lt;/p>
&lt;ol>
&lt;li>Compiler could not infer non generic type from protocol set as a method parameter type neither its returning type, so we have to tell compiler the concrete type which is covered under generic one in method calling code rather then in method declaration one instead.&lt;/li>
&lt;li>Protocols with &lt;code>associatedtype&lt;/code> value could not be used as a constraint for generic method type parameter neither returning in swift version prior 5.7, so we need a way to pass that required restrictions into the call chain somehow to limit possible type to that that we’re awaiting for.&lt;/li>
&lt;/ol>
&lt;h2 id="the-solution" >The solution
&lt;span>
&lt;a href="#the-solution">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h2>&lt;p>Long story short: here’s the solution code.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-swift" data-lang="swift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protocol&lt;/span> &lt;span style="color:#a6e22e">Resultable&lt;/span>: Decodable { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ResultFirstKind&lt;/span>: Resultable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> firstKey: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> secondKey: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ResultSecondKind&lt;/span>: Resultable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> thidrKey: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> fourthKey: Bool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> fifthKey: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">APIResponse&lt;/span>&amp;lt;Result&amp;gt;: Decodable &lt;span style="color:#66d9ef">where&lt;/span> Result: Resultable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> id: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> result: Result
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> client: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">send&lt;/span>&amp;lt;Result&amp;gt;(uRLRequest: URLRequest, with session: URLSession) async &lt;span style="color:#66d9ef">throws&lt;/span> -&amp;gt; APIResponse&amp;lt;Result&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (data, response) = &lt;span style="color:#66d9ef">try&lt;/span> await session.data(&lt;span style="color:#66d9ef">for&lt;/span>: uRLRequest)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">guard&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> == response.statusCode &lt;span style="color:#66d9ef">else&lt;/span> { fatalError() }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">try&lt;/span> JSONDecoder().decode(APIResponse&amp;lt;Result&amp;gt;.&lt;span style="color:#66d9ef">self&lt;/span>, from: data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 6&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> result: APIResponse&amp;lt;ResultSecondKind&amp;gt; = &lt;span style="color:#66d9ef">try&lt;/span> await APIRequest.send(uRLRequest: URLRequest(url: URL(&lt;span style="color:#e6db74">&amp;#34;http://google.com&amp;#34;&lt;/span>)&lt;span style="color:#f92672">!&lt;/span>), with: URLSession.shared)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>explicitly declaring &lt;code>Result&lt;/code> type in function call is &lt;strong>required&lt;/strong>.&lt;/p>
&lt;/blockquote>
&lt;p>So let’s examine this bit of code more closely:&lt;/p>
&lt;ol>
&lt;li>&lt;code>Resultable&lt;/code> protocol declaration, this protocol restricts variation of types conforms &lt;code>Decodable&lt;/code> to types that we’re actually waiting to be in server response.&lt;/li>
&lt;li>Implementation of both possible &lt;code>Result&lt;/code> types which could be returned by a server, both of them are conformed both &lt;code>Resultable&lt;/code> and &lt;code>Decodable&lt;/code> protocols.&lt;/li>
&lt;li>&lt;code>APIResponse&amp;lt;Result&amp;gt;&lt;/code> structure declaration which also declares generic type &lt;code>Result&lt;/code> with constraint it to only such types that conforms &lt;code>Resultable&lt;/code> protocol.&lt;/li>
&lt;li>Generic method &lt;code>send&amp;lt;Result&amp;gt;(...) ... -&amp;gt; APIResponse&amp;lt;Result&amp;gt;&lt;/code> that returns concrete &lt;code>APIResponse&lt;/code> type but with yet so far generic property &lt;code>Result&lt;/code>. So the code so far solves just second problem of given two, and the first is still there and counting.&lt;/li>
&lt;li>At this line compiler were actually failed previously. Because it can’t decode generic type, it could decode only concrete types, but there’s none yet.&lt;/li>
&lt;li>Call of &lt;code>send&lt;/code> method. And this notation &lt;code>let result: APIResponse&amp;lt;ResultSecondKind&amp;gt; = ... send()&lt;/code> this is the thing. &lt;strong>This longhand notation are required&lt;/strong>, because this is the place and the way how and where we tell compiler what concrete type we’re awaiting for exact given call. And by this call compiller could infer what type will be in that exact object &lt;code>APIResponse&amp;lt;ResultSecondKind&amp;gt;&lt;/code> it’s &lt;code>ResultSecondKind&lt;/code> obviously.&lt;/li>
&lt;/ol>
&lt;p>There’s one more thing yet.&lt;/p>
&lt;p>All that way of managing this code is give you a passibility to extend that generic method to literally any amount of types with just one line of code by just conforming any given type to &lt;code>Resultable&lt;/code> protocol.&lt;/p>
&lt;p>And this working even on client side. So if you’re some network library (like us) this solutions gives your users the ability to create their own &lt;code>Result&lt;/code> types and using them instead of that you’re providing. This is the thing.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-swift" data-lang="swift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ClientImplementationResultSecond&lt;/span>: Responsable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> thidrKey: String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> fourthKey: Bool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> fifthKey: Int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// all good&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> result: APIResponse&amp;lt;ClientImplementationResultSecond&amp;gt; = &lt;span style="color:#66d9ef">try&lt;/span> await APIRequest.send(uRLRequest: URLRequest(url: URL(&lt;span style="color:#e6db74">&amp;#34;http://google.com&amp;#34;&lt;/span>)&lt;span style="color:#f92672">!&lt;/span>), with: URLSession.shared)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="limitations" >Limitations
&lt;span>
&lt;a href="#limitations">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h2>&lt;ul>
&lt;li>Again, this method doesn’t work if you’re using shorthand call (it’ll not compiles).&lt;/li>
&lt;li>And this method couldn’t be turned upside down to use it for &lt;code>encode&lt;/code> some generic type (e.g. create generic request). Or at least we haven’t found it yet, so if you do, please tell us.&lt;/li>
&lt;/ul>
&lt;h2 id="conclusion" >Conclusion
&lt;span>
&lt;a href="#conclusion">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h2>&lt;p>So this is how the lack of generic protocol usage could be bypassed. This method is less required during 5.7 release, because of implementing both &lt;a href="https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md" title="">SE-0309&lt;/a> and &lt;a href="https://github.com/apple/swift-evolution/blob/main/proposals/0346-light-weight-same-type-syntax.md" title="">SE-0346&lt;/a> proposals. But yet there’s (as always) no backward capability provided by Apple, there’s a room for using this solution at least for two more years if you’re indy and for kinda forever if you’re hard tuff enterprise app core team developer.&lt;/p></description></item><item><title/><link>https://yaroslavyaroslav.github.io/about/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://yaroslavyaroslav.github.io/about/</guid><description>&lt;h1 id="this-is-me" >This is me
&lt;span>
&lt;a href="#this-is-me">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h1></description></item></channel></rss>