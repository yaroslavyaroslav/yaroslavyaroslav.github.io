<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Dynamic generic types - My dear diary</title><meta name=description content="Abstract Prior to the Swift 5.7 release, there was a lack of support for using protocols with associatedtype as a type of passed argument or as a returning type. Prior to this release, the options to solve such tasks as with SE-0309 and SE-0346 were not available.
However, these tasks still exist. In the past, Apple&rsquo;s solution was to do a lot of boilerplate code, such as writing many overloaded methods to cover all cases."><link rel=icon type=image/x-icon href=https://yaroslavyaroslav.github.io/favicon.ico><link rel=apple-touch-icon-precomposed href=https://yaroslavyaroslav.github.io/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=https://yaroslavyaroslav.github.io/css/style.min.aac3b3a2a3235d20a652d9ccde7ec59be09f74c45de387513f681d02f3912b95.css integrity="sha256-qsOzoqMjXSCmUtnM3n7Fm+CfdMRd44dRP2gdAvORK5U="><script src=https://yaroslavyaroslav.github.io/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js type=text/javascript integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script><meta property="og:title" content="Dynamic generic types"><meta property="og:description" content="Abstract Prior to the Swift 5.7 release, there was a lack of support for using protocols with associatedtype as a type of passed argument or as a returning type. Prior to this release, the options to solve such tasks as with SE-0309 and SE-0346 were not available.
However, these tasks still exist. In the past, Apple&rsquo;s solution was to do a lot of boilerplate code, such as writing many overloaded methods to cover all cases."><meta property="og:type" content="article"><meta property="og:url" content="https://yaroslavyaroslav.github.io/posts/generic-protocol-workaround/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-03T17:01:43+07:00"><meta property="article:modified_time" content="2022-10-03T17:01:43+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dynamic generic types"><meta name=twitter:description content="Abstract Prior to the Swift 5.7 release, there was a lack of support for using protocols with associatedtype as a type of passed argument or as a returning type. Prior to this release, the options to solve such tasks as with SE-0309 and SE-0346 were not available.
However, these tasks still exist. In the past, Apple&rsquo;s solution was to do a lot of boilerplate code, such as writing many overloaded methods to cover all cases."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><h1 class=site-title><a href=/>My dear diary</a></h1><ul class=social-icons><li><a href=https://twitter.com/Yaroslav_Ya title=Twitter rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></li><li><a href=https://github.com/yaroslavyaroslav title=Github rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://www.linkedin.com/in/yaroslav-yashin-65706083/ title=Linkedin rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></li><li><a href=https://yaroslavyaroslav.github.io/index.xml title=RSS rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328.0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765.0 183.105.0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686.0 38.981.0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></span></a></li></ul></div><nav><a href=https://yaroslavyaroslav.github.io/posts/ title>Archive</a>
<a href=https://yaroslavyaroslav.github.io/tags/ title>Tags</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">Dynamic generic types</h1></header></div><div class="content e-content"><h2 id=abstract>Abstract
<span><a href=#abstract><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>Prior to the Swift 5.7 release, there was a lack of support for using protocols with associatedtype as a type of passed argument or as a returning type. Prior to this release, the options to solve such tasks as with <a href=https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md title>SE-0309</a> and <a href=https://github.com/apple/swift-evolution/blob/main/proposals/0346-light-weight-same-type-syntax.md title>SE-0346</a> were not available.</p><p>However, these tasks still exist. In the past, Apple&rsquo;s solution was to do a lot of boilerplate code, such as writing many overloaded methods to cover all cases.</p><p>Let&rsquo;s review another solution that solves some, but not all of these tasks.</p><h2 id=problem-overview>Problem overview
<span><a href=#problem-overview><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>The problem comes from the restrictions of protocols and generics. To illustrate this, let&rsquo;s consider the task of implementing a method that can decode any Decodable object. This is a useful task when receiving a server response wrapped in object that couldn&rsquo;t be mapped to a JSON key, and we want to cover this response with a single type.</p><p>As an example, we have two possible received JSON objects:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;result&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;firstKey&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;secondKey&#34;</span>: <span style=color:#e6db74>&#34;second&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;client&#34;</span>: <span style=color:#e6db74>&#34;iOS&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;result&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;thidrKey&#34;</span>: <span style=color:#e6db74>&#34;okok&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;fourthKey&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;fifthKey&#34;</span>: <span style=color:#ae81ff>1231</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;client&#34;</span>: <span style=color:#e6db74>&#34;iOS&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The preferred solution would be to implement one generic method and three structures, one for each given result case, and one for the response itself.</p><p>We can define structs for each type of the result object:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// `result` object for first kind of server response</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ResultFirstKind</span>: Decodable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> firstKey: Int
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> secondKey: String
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// `result` object for second kind of server response</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ResultSecondKind</span>: Decodable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> thidrKey: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> fourthKey: Bool
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> fifthKey: Int
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>and a wrapper struct for the response:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Response</span>: Decodable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> id: Int
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result: Decodable
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> client: String
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>However, when we try to implement a method that uses this struct, such as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>send</span>(uRLRequest: URLRequest, with session: URLSession) async <span style=color:#66d9ef>throws</span> -&gt; Response {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> (data, response) = <span style=color:#66d9ef>try</span> await session.data(<span style=color:#66d9ef>for</span>: uRLRequest)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>guard</span> <span style=color:#ae81ff>200</span> == response.statusCode <span style=color:#66d9ef>else</span> { fatalError() }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>try</span> JSONDecoder().decode(APIResponse.<span style=color:#66d9ef>self</span>, from: data)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>we face a problem: the compiler cannot infer the type of the concrete result field in the implementation for an exact call with ``. Since it could be any decodable type, there is not even a hint as to which it will be in the exact call.</p><h2 id=problem-summary>Problem summary
<span><a href=#problem-summary><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><ol><li>In Swift, the compiler cannot infer a non-generic type from a protocol set as a method parameter type or its returning type. We have to explicitly specify the concrete type that is covered under the generic one in the method calling code and in the method declaration.</li><li>Prior to Swift version 5.7, protocols with associatedtype values could not be used as a constraint for a generic method type parameter or return type. Therefore, we need a way to pass the required restrictions into the call chain to limit the possible types to those that we are expecting.</li></ol><h2 id=the-solution>The solution
<span><a href=#the-solution><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>The solution is to use a combination of generics and protocols to provide the necessary type information to the compiler.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// 1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Resultable</span>: Decodable { }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 2</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ResultFirstKind</span>: Resultable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> firstKey: Int
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> secondKey: String
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 2</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ResultSecondKind</span>: Resultable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> thidrKey: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> fourthKey: Bool
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> fifthKey: Int
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 3</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>APIResponse</span>&lt;Result&gt;: Decodable <span style=color:#66d9ef>where</span> Result: Resultable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> id: Int
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result: Result
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> client: String
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 4</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>send</span>&lt;Result&gt;(uRLRequest: URLRequest, with session: URLSession) async <span style=color:#66d9ef>throws</span> -&gt; APIResponse&lt;Result&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> (data, response) = <span style=color:#66d9ef>try</span> await session.data(<span style=color:#66d9ef>for</span>: uRLRequest)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>guard</span> <span style=color:#ae81ff>200</span> == response.statusCode <span style=color:#66d9ef>else</span> { fatalError() }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>try</span> JSONDecoder().decode(APIResponse&lt;Result&gt;.<span style=color:#66d9ef>self</span>, from: data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 5</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> result: APIResponse&lt;ResultSecondKind&gt; = <span style=color:#66d9ef>try</span> await APIRequest.send(uRLRequest: URLRequest(url: URL(<span style=color:#e6db74>&#34;http://google.com&#34;</span>)<span style=color:#f92672>!</span>), with: URLSession.shared)
</span></span></code></pre></div><ol><li>The <code>Resultable</code> protocol is declared, this protocol restricts the variation of types that conform to <code>Decodable</code> to types that we are expecting to be in the server response.</li><li>The possible <code>Result</code> types that could be returned by the server are implemented. Both of them conform to both the <code>Resultable</code> and <code>Decodable</code> protocols.</li><li>The <code>APIResponse&lt;Result></code> structure is declared which declares a generic type <code>Result</code> with a constraint to types that conform to the <code>Resultable</code> protocol.</li><li>A generic method <code>send&lt;Result>(...) ... -> APIResponse&lt;Result></code> is implemented that returns a concrete <code>APIResponse</code> type but with a yet generic property <code>Result</code>.</li><li>In the call of the send method, explicitly declaring the <code>Result</code> type in the function call is required. This notation let result: <code>APIResponse&lt;ResultSecondKind> = ... send()</code> tells the compiler what concrete type we are expecting for a given call. And by this call, the compiler can infer the type that will be used.</li></ol><p>In this way, we can use the <code>APIResponse</code> struct to wrap any type of <code>Decodable</code> object and the send method to handle it correctly.</p><p>This solution also gives you the possibility to extend the generic method with one line of code by conforming a given type to the Resultable protocol.</p><p>This works on the client side as well. If you&rsquo;re using a network library, this is a great feature because your users can pass in their own Result types instead of the ones provided by you, which gives a broad flexibility without increasing complexity.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ClientImplementationResultSecond</span>: Responsable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> thidrKey: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> fourthKey: Bool
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> fifthKey: Int
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// all good</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> result: APIResponse&lt;ClientImplementationResultSecond&gt; = <span style=color:#66d9ef>try</span> await APIRequest.send(uRLRequest: URLRequest(url: URL(<span style=color:#e6db74>&#34;http://google.com&#34;</span>)<span style=color:#f92672>!</span>), with: URLSession.shared)
</span></span></code></pre></div><p>Limitations</p><ul><li>This method does not work if you&rsquo;re using shorthand call (it will not compile).</li><li>This method couldn&rsquo;t be turned upside down to use it for encode generic type (e.g. create generic request). At least we haven&rsquo;t found it yet, so if you do, please let us know.</li></ul></div><div class=post-info><div class="post-date dt-published">2022-10-03</div><a class="post-hidden-url u-url" href=https://yaroslavyaroslav.github.io/posts/generic-protocol-workaround/>https://yaroslavyaroslav.github.io/posts/generic-protocol-workaround/</a>
<a href=https://yaroslavyaroslav.github.io/ class="p-name p-author post-hidden-author h-card" rel=me>Yaroslav Yashin</a><div class=post-taxonomies><ul class=post-tags><li><a href=https://yaroslavyaroslav.github.io/tags/swift/>#swift</a></li><li><a href=https://yaroslavyaroslav.github.io/tags/generics/>#generics</a></li><li><a href=https://yaroslavyaroslav.github.io/tags/decodable/>#decodable</a></li><li><a href=https://yaroslavyaroslav.github.io/tags/api/>#API</a></li></ul></div></div></article><script src=https://utteranc.es/client.js repo=yaroslavyaroslav/yaroslavyaroslav.github.io theme=github-dark label issue-term=url crossorigin=anonymous async></script></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>Â© Yaroslav Yashin, 2023<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br></p></div><button class=theme-switcher>
Dark theme</button>
<script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),switchButton&&(changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)),showContent()});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton&&(switchButton.textContent=currentTheme=="dark"?"Light theme":"Dark theme")}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}</script></div><p class="h-card vcard"><a href=https://yaroslavyaroslav.github.io/ class="p-name u-url url fn" rel=me>Yaroslav Yashin</a>
/
<a class="p-email u-email email" rel=me href=mailto:caimans-spurs-0u@icloud.com>caimans-spurs-0u@icloud.com</a></p></footer></div></body></html>